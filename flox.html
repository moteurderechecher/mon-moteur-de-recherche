<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Mon Application Flox</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
<style>

.favorites-bar-controls {
  display: flex;
  gap: 8px;
  position: absolute;
  top: 111px;
  left: 41px; /* 46px - 5px */
  z-index: 999;
}

.favorites-bar-btn {
  padding: 6px 10px;
  font-size: 1rem;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.favorites-bar-btn.refresh-btn {
  background: #28a745;
}

.favorites-bar-btn:hover {
  background: #0056b3;
}

.favorites-bar-btn.refresh-btn:hover {
  background: #218838;
}

/* Window Controls Styles */
.window-controls {
  position: fixed;
  top: 0;
  right: 0;
  z-index: 1000000;
  display: flex;
  gap: 8px;
  background: transparent;
  padding: 8px 12px 0 0;
}

.window-btn {
  background: #ff1919;
  color: #ffffff;
  border: none;
  font-size: 18px;
  padding: 0px 5px;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.window-btn:hover {
  background: #007bff;
}

@media (max-width: 600px) {
  .window-controls {
    top: 0;
    right: 0;
    gap: 4px;
    padding: 4px 4px 0 0;
  }
  .window-btn {
    font-size: 16px;
    padding: 4px 7px;
  }
}

/* Tab Bar Styles */
.tab-bar {
  width: 100%;
  display: flex;
  background: #000000;
  padding: 0 0 0 0;
  border-bottom: 2px solid #007bff;
  overflow-x: auto;
  z-index: 10;
  position: relative;
  height: 32px;
  box-sizing: border-box;
  margin-left: -5px; /* D√©calage de 5px vers la gauche */
}

/* Hamburger Menu Styles */
.hamburger-menu {
  position: absolute;
  top: 55px;
  right: 15px;
  left: auto;
  z-index: 100;
}

#hamburgerBtn {
  background: #00000000;
  color: #fff;
  border: none;
  font-size: 22px;
  padding: 6px 10px;
  border-radius: 5px;
  cursor: pointer;
}

#hamburgerBtn:hover {
  background: #007bff;
}

.side-menu {
  position: fixed;
  top: 54px;
  right: -260px;
  left: auto;
  width: 20px;
  height: calc(100% - 54px);
  background: #000000;
  color: #fff;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.548);
  padding-top: 60px;
  transition: right 0.3s;
  z-index: 200;
}

.side-menu.open {
  right: 0;
}

.side-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.side-menu ul li {
  margin: 20px 0;
  text-align: left;
}

.side-menu ul li a, .side-menu ul li button {
  color: #fff;
  text-decoration: none;
  font-size: 18px;
  padding: 10px 24px;
  display: block;
  border-radius: 4px;
  transition: background 0.2s;
  background: none;
  border: none;
  text-align: left;
  width: 100%;
  cursor: pointer;
}

.side-menu ul li a:hover, .side-menu ul li button:hover {
  background: #007bff;
}

.close-side-menu {
  position: absolute;
  top: 12px;
  left: 12px;
  right: auto;
  background: transparent;
  color: #fff;
  border: none;
  font-size: 28px;
  cursor: pointer;
}

@media (max-width: 600px) {
  .side-menu {
    width: 80vw;
    min-width: 160px;
  }
}

/* Base Styles */
html, body {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #2C3E50, #4CA1AF);
  color: #fff;
  font-family: 'Arial', sans-serif;
  display: flex;
  flex-direction: column;
  transition: background-color 0.3s, color 0.3s;
}

.dark-mode {
  background: linear-gradient(135deg, #121212, #1a1a1a);
  color: #ffffff;
}

.tab {
  background: #ece7e7;
  color: white;
  padding: 6px 10px;
  margin-right: 4px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 11px;
  height: 22px;
}

.tab.active {
  background: #007bff;
}

.tab .close-btn {
  margin-left: 8px;
  color: rgb(9, 54, 204);
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 13px;
  height: 18px;
  width: 18px;
  line-height: 1;
  padding: 0;
}

.tab .close-btn:hover {
  color: #000000;
}

.add-tab {
  padding: 6px 10px;
  margin-left: 4px;
  background: #007bff;
  color: rgb(0, 0, 0);
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 11px;
  height: 22px;
}

.add-tab:hover {
  background: #0056b3;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
}

/* R√©duction hauteur barre de lien personnalis√©e */
#customLinkBar {
  height: 36px !important;
  min-height: 36px !important;
  padding: 0 10px !important;
  gap: 6px !important;
  margin-left: 21px !important; /* 31px - 10px */
}

#customLinkBar input,
#customLinkBar button {
  height: 28px !important;
  font-size: 1rem !important;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

/* R√©duction hauteur barre favoris rapide */
#favoritesShortcutBar {
  padding: 6px 10px !important;
  gap: 8px !important;
  min-height: 32px !important;
  font-size: 0.95rem !important;
  left: 31px; /* 41px - 10px */
}

#favoritesShortcutBar > span {
  font-size: 0.95rem !important;
  margin-right: 6px;
}
/* Suppression de l'√©toile */
#favoritesShortcutBar > span i.fas.fa-star {
  display: none !important;
}


/* R√©duction hauteur barre favoris */
.favorites-bar {
  gap: 6px !important;
  padding: 6px 8px !important;
  min-height: 28px !important;
  font-size: 0.95rem !important;
}

.search-container {
  display: flex;
  width: 80%;
  max-width: 700px;
  min-height: 32px;
}

.search-container input {
  flex: 1;
  padding: 8px;
  font-size: 15px;
  border: 1px solid #ccc;
  border-radius: 5px 0 0 5px;
  height: 28px;
}

.search-container button {
  padding: 8px 12px;
  font-size: 15px;
  color: #fff;
  background-color: #007bff;
  border: 1px solid #007bff;
  border-radius: 0 5px 5px 0;
  cursor: pointer;
  height: 28px;
}

.search-container button:hover {
  background-color: #0056b3;
}

/* Webview for DuckDuckGo */
#searchResults {
  display: flex !important;
  flex: 1;
  width: 100vw;
  height: calc(100vh - 44px);
  border: none;
  overflow: auto;
  display: none;
  width: 100%;
  height: calc(100% - 44px);
  border: none;
}

.control-buttons button {
  margin-right: 8px;
  padding: 2px 6px !important;
  font-size: 0.95rem !important;
  min-width: 24px !important;
  height: 24px !important;
  border-radius: 5px;
}

.control-buttons button:hover {
  background-color: #0056b3;
}

footer {
  margin-top: 20px;
  font-size: 13px;
  color: #ddd;
}
</style>
<style>
#globalLoader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(to bottom right, #1a1a1a, #333);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999999;
  opacity: 1;
  transition: opacity 0.6s ease;
}
#globalLoader .spinner {
  border: 8px solid #f3f3f3;
  border-top: 8px solid #007bff;
  border-radius: 50%;
  width: 80px;
  height: 80px;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
<style>
#globalLoader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: #000000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 999999;
  color: #fff;
  font-family: 'Arial Black', sans-serif;
  font-size: 2.5rem;
  opacity: 1;
  transition: opacity 0.5s ease;
}

.loader-text {
  color: white;
  margin-bottom: 30px;
  letter-spacing: 5px;
  font-size: 3rem;
}

.loader-bar {
  width: 60%;
  max-width: 400px;
  height: 20px;
  background: #333;
  border: 2px solid #555;
  border-radius: 5px;
  overflow: hidden;
}

.loader-progress {
  width: 0%;
  height: 100%;
  background: linear-gradient(to right, #00aaff, #0077ff);
  transition: width 0.2s ease;
}
</style>
<style>

#operaSidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 36px;
  height: 100vh;
  background: linear-gradient(to bottom, #111, #1a1a1a);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 10px;
  z-index: 999;
  border-right: 1px solid #333;
}
.sidebar-icon {
  background: none;
  border: none;
  color: #fff;
  font-size: 18px;
  padding: 8px;
  cursor: pointer;
  width: 100%;
}
.sidebar-icon:hover {
  background: #444;
}
.sidebar-icon:hover {
  background: #444;
}
</style>
<style>
body.minimal {
  background: #000 !important;
  color: #fff !important;
  font-family: sans-serif;
}
body.minimal * {
  border-radius: 0 !important;
  box-shadow: none !important;
}
</style>
<script>
function loadInWebview(url) {
  const webview = document.getElementById('searchResults');
  if (webview) {
    webview.src = url;
    webview.style.display = 'flex';
    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('footer').style.display = 'none';
    document.getElementById('controlButtons').style.display = 'flex';
  }
}
</script>
</head>
<body>
<div id="initialLanguageModal" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.75); display:flex; align-items:center; justify-content:center; z-index:100000;">
<div style="background:#222; color:#fff; padding:30px; border-radius:10px; width:300px; text-align:center;">
<h2 style="margin-bottom:20px;">üåê Choisissez votre langue</h2>
<button onclick="selectInitialLanguage('fr')">Fran√ßais üá´üá∑</button><br/><br/>
<button onclick="selectInitialLanguage('en')">English üá¨üáß</button><br/><br/>
<button onclick="selectInitialLanguage('es')">Espa√±ol üá™üá∏</button><br/><br/>
<button onclick="selectInitialLanguage('pt')">Portugu√™s üáßüá∑</button><br/><br/>
<button onclick="selectInitialLanguage('br')">Brezhoneg üáßüá∑</button>
</div>
</div>
<script>
window.selectInitialLanguage = function(lang) {
  localStorage.setItem('floxLang', lang);
  document.getElementById('initialLanguageModal').style.display = 'none';
  if (typeof applyTranslations === "function") applyTranslations();
  console.log("Langue s√©lectionn√©e :", lang);
};

window.closeLanguageModal = function() {
  document.getElementById('initialLanguageModal').style.display = 'none';
};

window.addEventListener('DOMContentLoaded', () => {
  const chosenLang = localStorage.getItem('floxLang');
  if (!chosenLang) {
    const modal = document.getElementById('initialLanguageModal');
    if (modal) modal.style.display = 'flex';
  }
});
</script>
<div id="historyModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
<div style="background:#1e1e1e; color:#fff; padding:20px; border-radius:10px; width:90%; max-width:600px; max-height:85vh; overflow:auto; position:relative;">
<button onclick="document.getElementById('historyModal').style.display='none'" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.6rem; cursor:pointer;">√ó</button>
<h2 style="margin-top:0; font-size:1.5rem;">üìú Historique des recherches</h2>
<div id="searchHistoryContainer" style="margin-top:15px; display:flex; flex-direction:column; gap:6px;"></div>
</div>
</div>
<div id="searchPopup" style="display:none; position:fixed; top:70px; left:60px; background:#222; color:#fff; padding:20px; border-radius:8px; z-index:99999; width:300px;">
<select id="searchEngineSelector" style="margin-bottom:10px; padding:6px; font-size:1rem;">
<option value="google">Google</option>
<option value="duckduckgo">DuckDuckGo</option>
<option value="bing">Bing</option>
<option value="brave">Brave</option>
</select>
<button onclick="loadInWebview('https://www.youtube.com')" style="background:#cc0000; color:#fff; border:none; width:100%; padding:10px; margin-bottom:6px; cursor:pointer;">YouTube</button>
<button onclick="loadInWebview('https://www.twitch.tv')" style="background:#6441a5; color:#fff; border:none; width:100%; padding:10px; margin-bottom:6px; cursor:pointer;">Twitch</button>
<button onclick="loadInWebview('https://www.tiktok.com')" style="background:#000; color:#fff; border:none; width:100%; padding:10px; margin-bottom:6px; cursor:pointer;">TikTok</button>
</div>
<div id="operaSidebar"><button class="sidebar-icon" onclick="toggleSearchOptions()" title="Rechercher">üîç</button><button class="sidebar-icon" onclick="document.getElementById('backgroundCustomizeModal').style.display = 'flex'" title="Personnaliser le fond">üé®</button><button class="sidebar-icon" onclick="document.getElementById('passwordManagerModal').style.display = 'flex'" title="Gestionnaire de mots de passe">üîë</button><button class="sidebar-icon" onclick="document.getElementById('downloadsModal').style.display = 'flex'" title="T√©l√©chargements">‚¨áÔ∏è</button><button class="sidebar-icon" onclick="document.getElementById('settingsModal').style.display = 'flex'" title="Param√®tres">‚öôÔ∏è</button></div>
<div id="settingsModal" style="display:none; justify-content:center; align-items:center; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:9999; justify-content:center; align-items:center;">
<div style="background:#1e1e1e; color:#fff; padding:20px; border-radius:10px; width:90%; max-width:600px; max-height:85vh; overflow:auto; position:relative;">
<button onclick="document.getElementById('settingsModal').style.display='none'" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.6rem; cursor:pointer;">√ó</button>
<h2 style="margin-top:0; font-size:1.5rem;">‚öôÔ∏è Param√®tres</h2>
<div style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
<button id="customBgMenuBtn" style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; text-align:left; border-radius:6px; cursor:pointer;">üé® Personnaliser le fond</button>
<button id="openPwdManagerBtn" style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; text-align:left; border-radius:6px; cursor:pointer;">üîë Gestionnaire de mots de passe</button>
<button id="languageMenuBtn" style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; text-align:left; border-radius:6px; cursor:pointer;">
  üåê Langue
</button>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const langBtn = document.getElementById("languageMenuBtn");
  if (langBtn) {
    langBtn.addEventListener("click", function () {
      document.getElementById('languageModal').style.display = 'flex';
    });
  }
});
</script>
<div class="optimizer-section"> <h2>üõ†Ô∏è Optimisation syst√®me</h2> <button id="auto-optimize">Optimiser automatiquement</button> <button id="manual-optimize-toggle">Optimisation manuelle</button>
<div id="manual-options" style="display: none; margin-top: 15px;">
<label>Quantit√© de RAM √† lib√©rer :</label>
<input id="ram-slider" max="100" min="0" step="10" type="range" value="50"/>
<span id="ram-value">50%</span><br/><br/>
<label><input id="clear-temp" type="checkbox"/> Supprimer fichiers temporaires</label><br/>
<label><input id="clear-downloads" type="checkbox"/> Supprimer les t√©l√©chargements</label><br/><br/>
<button id="run-manual-optimize">Lancer optimisation manuelle</button>
<button onclick="optimizeSystemForGaming()" style="background:#28a745; color:#fff; padding:10px; margin-top:12px; border:none; border-radius:5px; font-size:1rem;">
    üöÄ Optimiser le syst√®me pour le gaming
  </button>
</div>
<h3 style="margin-top: 25px;">üß† Profils GPU</h3>
<button id="gpu-gaming">üéÆ Mode Gaming</button>
<button id="gpu-dev">üíª Mode D√©veloppement</button>
</div>
<script src="renderer.js"></script>
<script>
function optimizeSystemForGaming() {
  if (typeof require !== "function") {
    alert("Cette fonctionnalit√© n√©cessite l'environnement Electron/Node.js.");
    return;
  }
  const { exec } = require('child_process');
  const os = require('os');

  const ramGB = (os.totalmem() / (1024 ** 3)).toFixed(2);
  alert("üß† RAM install√©e : " + ramGB + " Go");

  exec('reg add "HKCU\\Software\\Microsoft\\GameBar" /v AllowAutoGameMode /t REG_DWORD /d 1 /f', () => {
    console.log("üéÆ Mode Jeu activ√©");
  });

  exec('powercfg -setactive SCHEME_MIN', () => {
    console.log("‚ö° Mode Performances √©lev√©es activ√©");
  });

  exec("ping 8.8.8.8", (err, stdout) => {
    if (!err) alert("üì∂ R√©sultat du ping Google DNS :\n\n" + stdout);
  });

  exec('powershell -Command "Get-PhysicalDisk | Select MediaType, Size"', (err, stdout) => {
    if (!err) alert("üíæ Disques d√©tect√©s :\n\n" + stdout);
  });
}
</script>
<div style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
<label style="font-size:15px; color:#fff;">
    üéµ Musique de fond :
    <input accept="audio/*" id="backgroundMusicFile" style="margin-left:10px;" type="file"/>
</label>
<div style="display:flex; align-items:center; gap:10px;">
<button id="toggleMusicBtn" style="background:#333; color:#fff; border:none; border-radius:6px; padding:7px 14px; font-size:1rem; cursor:pointer;">
      ‚ñ∂Ô∏è/‚è∏Ô∏è
    </button>
<input id="volumeSlider" max="1" min="0" step="0.01" style="width:120px;" type="range" value="0.3"/>
<span style="font-size:0.95em; color:#aaa;">Volume</span>
</div>
</div>
<div style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
<label style="font-size:15px; color:#fff;">
    ‚å®Ô∏è Bruit de clavier personnalis√© :
    <input accept="audio/*" id="customKeyboardSound" style="margin-left:10px;" type="file"/>
</label>
<button id="keyboardSoundToggleBtn" style="background:#333; color:#fff; border:none; border-radius:6px; padding:7px 14px; font-size:1rem; cursor:pointer; margin-top:6px;">
    D√©sactiver
  </button>
</div>
<button onclick="document.getElementById('resolutionModal').style.display = 'flex'" style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; text-align:left; border-radius:6px; cursor:pointer;">
  üñ•Ô∏è Changer la r√©solution
</button>
<div id="resolutionModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:99998; align-items:center; justify-content:center;">
<div style="background:#222; color:#fff; border-radius:10px; width:360px; padding:20px; box-shadow:0 8px 32px #0008; position:relative;">
<button aria-label="Fermer" id="closeResolutionBtn" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.7rem; cursor:pointer;">√ó</button>
<h2 style="text-align:center;">üñ•Ô∏è Choisir la r√©solution</h2>
<select id="resolutionSelect" style="width:100%; padding:8px; font-size:1rem; border-radius:5px; margin-top:15px;">
<option value="3840x2160">4K UHD (3840x2160)</option>
<option value="2560x1440">2K QHD (2560x1440)</option>
<option value="1920x1080">Full HD (1920x1080)</option>
<option value="1600x900">HD+ (1600x900)</option>
<option value="1366x768">HD (1366x768)</option>
<option value="1280x720">720p (1280x720)</option>
<option value="1024x576">WSVGA (1024x576)</option>
</select>
<p id="currentResolution" style="margin-top:20px; text-align:center; font-size:0.95rem; color:#aaa;">
      R√©solution actuelle : d√©tect√©e...
    </p>
<button onclick="applyResolution()" style="margin-top:15px; width:100%; padding:10px; font-size:1rem; background:#007bff; color:#fff; border:none; border-radius:5px; cursor:pointer;">
      Appliquer
    </button>
</div>
</div>
<script>
function openResolutionModal() {
  const modal = document.getElementById("resolutionModal");
  const resText = `R√©solution actuelle : ${window.innerWidth}x${window.innerHeight}`;
  document.getElementById("currentResolution").textContent = resText;
  modal.style.display = "flex";
}

document.getElementById("closeResolutionBtn").onclick = function () {
  document.getElementById("resolutionModal").style.display = "none";
};

function applyResolution() {
  const value = document.getElementById("resolutionSelect").value;
  const [width, height] = value.split("x");
  document.body.style.width = width + "px";
  document.body.style.height = height + "px";
  document.body.style.overflow = "auto";
  alert("R√©solution appliqu√©e : " + value);
  document.getElementById("resolutionModal").style.display = "none";
}
</script>
</div>
<button id="openHistoryBtn" style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; text-align:left; border-radius:6px; cursor:pointer; width:100%;">üìú Historique</button><div style="margin-top:25px; display:flex; flex-direction:column; gap:12px;"><button style="background:#333; color:#fff; font-size:16px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; text-align:left;">üë• Gestion multi-utilisateur</button><button style="background:#343a40; color:#fff; font-size:16px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; text-align:left;">üïµÔ∏è Mode incognito</button><button style="background:#007bff; color:#fff; font-size:16px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; text-align:left;">üì¶ Exporter/Importer les mots de passe</button></div></div>
<!-- Remove this duplicate sidebar, keep only one with id="operaSidebar" -->
</div>
<audio id="backgroundMusic" loop=""></audio>
<audio id="keyboardSound" preload="auto">
<source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_e8b3a4019c.mp3?filename=mechanical-keyboard-single-press-1-101107.mp3" type="audio/mpeg"/>
</audio>
<div id="globalLoader">
<div class="loader-text">FLOX</div>
<div class="loader-bar">
<div class="loader-progress" id="loaderProgress"></div>
</div>
</div>
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
<script>
// Indique que l'application est en contexte desktop
window.isDesktopApp = true;
</script><div id="floxSplashScreen">
<div class="flox-splash-logo">
<i class="fas fa-bolt"></i>
<span>Flox</span>
</div>
</div>
<!-- Barre d'onglets -->

<!-- Bouton Se connecter am√©lior√© -->
<div class="hamburger-menu" style="position:fixed; top:55px; right:18px; z-index:100;">
  <button id="accountBtn" aria-label="Se connecter" style="background:rgba(30,34,40,0.92); border:none; color:white; font-size:24px; cursor:pointer; border-radius:50%; width:44px; height:44px; box-shadow:0 2px 8px #0005; transition:background 0.2s;">
    <i class="fas fa-user-circle" style="position:relative; top:-5px;"></i>
  </button>
</div>
<!-- Modal Connexion / Comptes am√©lior√© -->
<div id="accountModal" style="display:none; position:fixed; top:70px; right:20px; background:#23272f; color:white; padding:0; border-radius:12px; z-index:9999; width:340px; max-height:75vh; overflow-y:auto; box-shadow:0 8px 32px #000a; font-family:'Segoe UI',Arial,sans-serif;">
  <div style="padding:22px 22px 16px 22px; border-bottom:1px solid #333; display:flex; align-items:center; gap:12px;">
    <div style="background:#007bff; border-radius:50%; width:38px; height:38px; display:flex; align-items:center; justify-content:center;">
      <i class="fas fa-user-circle" style="font-size:1.6em; position:relative; top:-5px;"></i>
    </div>
    <span style="font-size:1.2em; font-weight:600;">Compte Flox</span>
    <button onclick="document.getElementById('accountModal').style.display='none'" style="margin-left:auto; background:none; border:none; color:#fff; font-size:1.5em; cursor:pointer;">√ó</button>
  </div>
  <div id="accountContent" style="padding:18px 22px 18px 22px;"></div>
</div>

<!-- Modal Changement de mot de passe -->
<div id="changePwdModal" style="display:none; position:fixed; top:90px; right:30px; background:#23272f; color:white; padding:0; border-radius:12px; z-index:10000; width:340px; max-width:95vw; box-shadow:0 8px 32px #000a; font-family:'Segoe UI',Arial,sans-serif;">
  <form id="changePwdForm" style="padding:22px;">
    <h3 style="margin-bottom:16px; font-size:1.1em; color:#fff;">üîí Changer le mot de passe</h3>
    <input id="oldPwd" type="password" placeholder="Ancien mot de passe" autocomplete="current-password" required style="width:100%;margin-bottom:10px;padding:9px 12px;border-radius:6px;border:1px solid #444;background:#181b20;color:#fff;font-size:1em;"/>
    <input id="newPwd" type="password" placeholder="Nouveau mot de passe" autocomplete="new-password" required style="width:100%;margin-bottom:10px;padding:9px 12px;border-radius:6px;border:1px solid #444;background:#181b20;color:#fff;font-size:1em;"/>
    <input id="confirmPwd" type="password" placeholder="Confirmer le nouveau mot de passe" autocomplete="new-password" required style="width:100%;margin-bottom:10px;padding:9px 12px;border-radius:6px;border:1px solid #444;background:#181b20;color:#fff;font-size:1em;"/>
    <button type="submit" class="account-action-btn login" style="width:100%;">Valider</button>
    <button type="button" onclick="document.getElementById('changePwdModal').style.display='none'" class="account-action-btn logout" style="width:100%;margin-top:7px;">Annuler</button>
  </form>
</div>

<style>
#accountModal input[type="text"], #accountModal input[type="password"] {
  width: 100%;
  margin-bottom: 10px;
  padding: 9px 12px;
  border-radius: 6px;
  border: 1px solid #444;
  background: #181b20;
  color: #fff;
  font-size: 1em;
  transition: border 0.2s;
}
#accountModal input[type="text"]:focus, #accountModal input[type="password"]:focus {
  border: 1.5px solid #007bff;
  outline: none;
}
#accountModal button:not([type="submit"]) {
  margin-top: 7px;
}
#accountModal .account-links-list {
  list-style: none;
  padding: 0;
  margin: 12px 0 10px 0;
}
#accountModal .account-links-list li {
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 4px;
}
#accountModal .account-links-list a {
  color: #00aaff;
  text-decoration: none;
  font-size: 1em;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  cursor: pointer;
}
#accountModal .account-links-list button {
  background: none;
  border: none;
  color: #dc3545;
  font-size: 1.1em;
  cursor: pointer;
  padding: 0 4px;
  border-radius: 4px;
  transition: background 0.15s;
}
#accountModal .account-links-list button:hover {
  background: #2c2c2c;
}
#accountModal #addLinkForm input {
  margin-bottom: 0;
}
#accountModal #addLinkForm button[type="submit"] {
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0 13px;
  font-size: 1.2em;
  cursor: pointer;
  transition: background 0.2s;
}
#accountModal #addLinkForm button[type="submit"]:hover {
  background: #0056b3;
}
#accountModal .account-action-btn {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 6px;
  font-size: 1em;
  margin-bottom: 8px;
  cursor: pointer;
  transition: background 0.2s;
}
#accountModal .account-action-btn.export {
  background: #6c757d;
  color: #fff;
}
#accountModal .account-action-btn.export:hover {
  background: #495057;
}
#accountModal .account-action-btn.logout {
  background: #dc3545;
  color: #fff;
}
#accountModal .account-action-btn.logout:hover {
  background: #a71d2a;
}
#accountModal .account-action-btn.login {
  background: #007bff;
  color: #fff;
}
#accountModal .account-action-btn.login:hover {
  background: #0056b3;
}
#accountModal .account-action-btn.register {
  background: #28a745;
  color: #fff;
}
#accountModal .account-action-btn.register:hover {
  background: #1e7e34;
}
#accountModal input[type="file"] {
  margin-bottom: 10px;
  color: #fff;
}
#accountModal .forgot-link {
  display: block;
  margin-bottom: 10px;
  color: #ffc107;
  text-align: right;
  font-size: 0.97em;
  cursor: pointer;
  text-decoration: underline;
}
#accountModal .forgot-link:hover {
  color: #fffbe7;
}
@media (max-width: 500px) {
  #accountModal, #changePwdModal {
    width: 98vw;
    right: 1vw;
    left: 1vw;
    min-width: 0;
    max-width: 99vw;
  }
}
</style>

<script>
function renderAccountModal() {
  const user = localStorage.getItem("floxCurrentUser");
  const modal = document.getElementById("accountModal");
  const content = document.getElementById("accountContent");
  if (!user) {
    content.innerHTML =
      `<div>
        <h3 style="margin-bottom:16px; font-size:1.15em; color:#fff;">üë• Connexion</h3>
        <input id="user" placeholder="Nom d'utilisateur" autocomplete="username" />
        <input id="pwd" type="password" placeholder="Mot de passe" autocomplete="current-password" />
        <span class="forgot-link" onclick="showForgotPwd()">Mot de passe oubli√© ?</span>
        <button class="account-action-btn login" onclick="loginUser()">Se connecter</button>
        <button class="account-action-btn register" onclick="registerUser()">Cr√©er un compte</button>
      </div>`;
    modal.style.display = "block";
  } else {
    let links = JSON.parse(localStorage.getItem("floxUserLinks_" + user) || "[]");
    let linksHtml = `
      <li><a onclick="openAccountLink('https://www.google.com')" tabindex="0"><i class="fab fa-google"></i> Google</a></li>
      <li><a onclick="openAccountLink('https://www.youtube.com')" tabindex="0"><i class="fab fa-youtube"></i> YouTube</a></li>
      <li><a onclick="openAccountLink('https://mail.google.com')" tabindex="0"><i class="fas fa-envelope"></i> Gmail</a></li>
    `;
    links.forEach((l, i) => {
      linksHtml += `<li>
        <a onclick="openAccountLink('${l.url.replace(/'/g,"\\'")}')" tabindex="0"><i class="fas fa-link"></i> ${l.name}</a>
        <button onclick="removeUserLink(${i})" title="Supprimer ce lien">üóëÔ∏è</button>
      </li>`;
    });
    content.innerHTML =
      `<div style="margin-bottom:8px; color:#aaa;">Connect√© en tant que <b style="color:#fff;">${user}</b></div>
      <ul class="account-links-list">${linksHtml}</ul>
      <form id="addLinkForm" style="display:flex;gap:5px;margin-bottom:10px;">
        <input id="newLinkName" placeholder="Nom" style="flex:1;padding:7px;" required />
        <input id="newLinkUrl" placeholder="Lien (https://...)" style="flex:2;padding:7px;" required />
        <button type="submit" title="Ajouter un lien">+</button>
      </form>
      <button class="account-action-btn export" onclick="exportUserData()">‚¨áÔ∏è Exporter mes liens</button>
      <input id="importFile" type="file" accept=".json" style="display:block;" onchange="importUserData(event)" />
      <button class="account-action-btn login" onclick="showChangePwdModal()" style="background:#ffc107;color:#23272f;">Changer le mot de passe</button>
      <button class="account-action-btn logout" onclick="logoutUser()">Se d√©connecter</button>`;
    setTimeout(() => {
      const form = document.getElementById("addLinkForm");
      if (form) {
        form.onsubmit = function(e) {
          e.preventDefault();
          const name = document.getElementById("newLinkName").value.trim();
          let url = document.getElementById("newLinkUrl").value.trim();
          if (!/^https?:\/\//i.test(url)) url = "https://" + url;
          if (name && url) {
            links.push({ name, url });
            localStorage.setItem("floxUserLinks_" + user, JSON.stringify(links));
            renderAccountModal();
          }
        };
      }
    }, 0);
  }
  modal.style.display = "block";
}

// Ouvre le lien dans le webview Flox (pas dans une nouvelle fen√™tre)
function openAccountLink(url) {
  document.getElementById("mainContent").style.display = "none";
  document.getElementById("footer").style.display = "none";
  document.getElementById("searchResults").style.display = "flex";
  if (document.getElementById("addressBarContainer")) {
    document.getElementById("addressBarContainer").style.display = "block";
  }
  document.getElementById("controlButtons").style.display = "flex";
  document.getElementById("searchResults").src = url;
  document.getElementById("accountModal").style.display = "none";
}

function loginUser() {
  const user = document.getElementById("user").value.trim();
  const pwd = document.getElementById("pwd").value.trim();
  if (user && pwd) {
    const users = JSON.parse(localStorage.getItem("floxUsers") || "{}");
    if (users[user] && users[user] === pwd) {
      localStorage.setItem("floxCurrentUser", user);
      renderAccountModal();
    } else {
      alert("Nom d'utilisateur ou mot de passe incorrect.");
    }
  }
}
function registerUser() {
  const user = document.getElementById("user").value.trim();
  const pwd = document.getElementById("pwd").value.trim();
  if (user && pwd) {
    let users = JSON.parse(localStorage.getItem("floxUsers") || "{}");
    if (users[user]) {
      alert("Ce nom d'utilisateur existe d√©j√†.");
      return;
    }
    users[user] = pwd;
    localStorage.setItem("floxUsers", JSON.stringify(users));
    localStorage.setItem("floxCurrentUser", user);
    renderAccountModal();
  }
}
function logoutUser() {
  localStorage.removeItem("floxCurrentUser");
  document.getElementById("accountModal").style.display = "none";
}
function removeUserLink(i) {
  const user = localStorage.getItem("floxCurrentUser");
  let links = JSON.parse(localStorage.getItem("floxUserLinks_" + user) || "[]");
  links.splice(i, 1);
  localStorage.setItem("floxUserLinks_" + user, JSON.stringify(links));
  renderAccountModal();
}
function exportUserData() {
  const user = localStorage.getItem("floxCurrentUser");
  if (!user) return;
  const links = localStorage.getItem("floxUserLinks_" + user) || "[]";
  const blob = new Blob([links], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "flox_liens_" + user + ".json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
function importUserData(event) {
  const user = localStorage.getItem("floxCurrentUser");
  const file = event.target.files[0];
  if (!file || !user) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (Array.isArray(data)) {
        localStorage.setItem("floxUserLinks_" + user, JSON.stringify(data));
        renderAccountModal();
      } else {
        alert("Fichier invalide.");
      }
    } catch {
      alert("Erreur de lecture du fichier.");
    }
  };
  reader.readAsText(file);
}

// Affiche la modale de changement de mot de passe
function showChangePwdModal() {
  document.getElementById("changePwdModal").style.display = "block";
  document.getElementById("accountModal").style.display = "none";
  // Reset form fields
  document.getElementById("oldPwd").value = "";
  document.getElementById("newPwd").value = "";
  document.getElementById("confirmPwd").value = "";
}

// Mot de passe oubli√© : propose de r√©initialiser le mot de passe si l'utilisateur existe
function showForgotPwd() {
  const username = document.getElementById("user")?.value.trim();
  if (!username) {
    alert("Veuillez entrer votre nom d'utilisateur pour r√©initialiser le mot de passe.");
    return;
  }
  let users = JSON.parse(localStorage.getItem("floxUsers") || "{}");
  if (!users[username]) {
    alert("Ce nom d'utilisateur n'existe pas.");
    return;
  }
  const newPwd = prompt("Entrez un nouveau mot de passe pour " + username + " :");
  if (newPwd && newPwd.length >= 3) {
    users[username] = newPwd;
    localStorage.setItem("floxUsers", JSON.stringify(users));
    alert("Mot de passe r√©initialis√© avec succ√®s !");
  } else if (newPwd) {
    alert("Le mot de passe doit contenir au moins 3 caract√®res.");
  }
}

// Gestion du changement de mot de passe
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("accountBtn");
  if (btn) {
    btn.onclick = function(e) {
      e.stopPropagation();
      renderAccountModal();
    };
  }
  const modal = document.getElementById("accountModal");
  if (modal) {
    window.addEventListener("click", function() {
      if (modal.style.display === "block") modal.style.display = "none";
    });
    modal.onclick = function(e) {
      e.stopPropagation();
    };
  }

  // Changement de mot de passe
  const changePwdForm = document.getElementById("changePwdForm");
  if (changePwdForm) {
    changePwdForm.onsubmit = function(e) {
      e.preventDefault();
      const oldPwd = document.getElementById("oldPwd").value.trim();
      const newPwd = document.getElementById("newPwd").value.trim();
      const confirmPwd = document.getElementById("confirmPwd").value.trim();
      const user = localStorage.getItem("floxCurrentUser");
      if (!user) {
        alert("Aucun utilisateur connect√©.");
        return;
      }
      const users = JSON.parse(localStorage.getItem("floxUsers") || "{}");
      if (!users[user] || users[user] !== oldPwd) {
        alert("Ancien mot de passe incorrect.");
        return;
      }
      if (newPwd.length < 3) {
        alert("Le nouveau mot de passe doit contenir au moins 3 caract√®res.");
        return;
      }
      if (newPwd !== confirmPwd) {
        alert("Les mots de passe ne correspondent pas.");
        return;
      }
      users[user] = newPwd;
      localStorage.setItem("floxUsers", JSON.stringify(users));
      alert("Mot de passe chang√© avec succ√®s !");
      document.getElementById("changePwdModal").style.display = "none";
      renderAccountModal();
    };
  }
  // Fermer la modale de changement de mot de passe si on clique dehors
  const changePwdModal = document.getElementById("changePwdModal");
  if (changePwdModal) {
    window.addEventListener("click", function(e) {
      if (changePwdModal.style.display === "block") {
        changePwdModal.style.display = "none";
      }
    });
    changePwdModal.onclick = function(e) {
      e.stopPropagation();
    };
  }
});
</script>
<div class="tab-bar" id="tabBar" style="margin-left:46px;">
<div class="tab active" id="defaultTab" onclick="switchToTab(this, 'mainContent')">
    Accueil
    <button class="close-btn" onclick="closeTab(this)">√ó</button>
</div>
<button class="add-tab" onclick="addNewTab()">+</button>
</div>
<div id="favoritesShortcutBar" style="display: flex; align-items: center; padding: 10px 16px; background: #1f1f1f; gap: 12px; border-bottom: 1px solid #444; position: relative;">
<span style="color: #ffc107;"><i class="fas fa-star"></i> Favoris rapides :</span>
<div id="favoritesShortcutList" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
<button onclick="manualAddFavorite()" style="background:#28a745; color:#fff; padding:6px 19px; border:none; border-radius:5px;">‚ûï Ajouter un favori</button>
</div>
<style>
  #favoritesShortcutBar {
    position: relative;
  }
  #favoritesShortcutBar {
    /* nothing extra, already relative */
  }
  #favoritesShortcutBar > span,
  #favoritesShortcutBar > #favoritesShortcutList,
  #favoritesShortcutBar > button[onclick^="manualAddFavorite"],
  #favoritesShortcutBar > button[onclick^="clearAllFavorites"] {
    /* default flow */
  }
  #favoritesShortcutBar {
    /* Move the whole bar's content 36px to the right */
    left: 36px;
  }
</style>
<script>
function manualAddFavorite() {
  const url = prompt("Entrez l'URL du favori :");
  if (!url) return;
  const title = prompt("Nom du favori :");
  if (!title) return;

  const favorites = JSON.parse(localStorage.getItem("floxFavorites") || "[]");
  favorites.push({ title, url });
  localStorage.setItem("floxFavorites", JSON.stringify(favorites));
  renderFavorites();
}
</script>
<div id="customLinkBar" style="height:56px; display:flex; align-items:center; background:#23272b; padding: 0 18px; gap:10px; border-bottom:1.5px solid #007bff;">
<input autocomplete="off" id="customLinkInput" placeholder="Entrez ou collez un lien ici..." style="flex:1; height:36px; border-radius:6px 0 0 6px; border:none; padding:0 14px; font-size:1.1rem; background:#1a1a1a; color:#fff; outline:none;" type="url"/>
<button id="customLinkGoBtn" style="height:36px; border-radius:0 6px 6px 0; border:none; background:#007bff; color:#fff; font-size:1.1rem; min-width:64px; cursor:pointer;">Aller</button>
</div>
<!-- D√©caler la barre de lien de 40px vers la droite -->
<style>
  /* Ajoutez ou fusionnez ceci dans votre <head> */
  #customLinkBar {
    margin-left: 46px !important;
  }
  @media (max-width: 600px) {
    #customLinkBar {
      margin-left: 0 !important; /* Pour √©viter un scroll horizontal sur mobile */
    }
  }
</style>
<script>
// Fonction pour ouvrir l'URL
document.getElementById('customLinkGoBtn').onclick = function() {
  const input = document.getElementById('customLinkInput');
  let url = input.value.trim();
  if (!url) return;

  // Ajoute https:// si l'utilisateur ne l'a pas mis
  if (!/^https?:\/\//i.test(url)) {
    url = "https://" + url;
  }
  window.open(url, '_blank', 'noopener');
};

// Entr√©e clavier = clic sur "Aller"
document.getElementById('customLinkInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    document.getElementById('customLinkGoBtn').click();
  }
});
</script>
<div class="favorites-bar-controls">
<button class="favorites-bar-btn" onclick="goBack()" title="Retour">‚¨ÖÔ∏è</button>
<button class="favorites-bar-btn refresh-btn" onclick="refreshResults()" title="Rafra√Æchir">üîÑ</button>
</div>
<div id="favoritesList" style="display:flex; gap:7px; flex:1 1 auto;"><div class="favorite-item" onclick="window.open('https://www.google.com', '_blank')" title="Google">Google</div></div>
<div class="control-buttons" id="controlButtons" style="display: none;"></div>
<!-- Boutons de contr√¥le de fen√™tre -->
<div class="window-controls">
<button class="window-btn" onclick="minimizeWindow()" title="R√©duire la fen√™tre">
<i class="fas fa-window-minimize"></i>
</button>
<button class="window-btn" onclick="toggleFullscreen()" title="Plein √©cran">
<i class="fas fa-expand"></i>
</button>
<button class="window-btn" onclick="closeApp()" title="Fermer l'application">
<i class="fas fa-times"></i>
</button>
</div>
<!-- Menu hamburger √† droite SOUS la barre d'onglets -->

<li></li>
<!-- Retour and Refresh Buttons -->
<div class="main-content" id="mainContent">
<h1><span style="color:white;">Flox</span></h1>
<div class="search-container">
<input autocomplete="off" id="searchInput" placeholder="" type="text"/>
<button id="searchBtn" onclick="searchDuckDuckGo()">Rechercher</button>
</div><div class="search-actions-row">
<button id="toggleDarkModeBtn" onclick="toggleDarkMode()" style="padding:8px 12px; margin:5px; font-size:1rem; background:#343a40; color:#fff; border:none; border-radius:6px; cursor:pointer;">
  üåô Mode sombre
</button>
<button id="clearHistoryBtn" style="padding:8px 12px; margin:5px; font-size:1rem; background:#dc3545; color:#fff; border:none; border-radius:6px; cursor:pointer;">
  üóëÔ∏è Supprimer l'historique
</button>
  <button id="btnIncognito" style="background:#343a40; color:#fff; font-size:16px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; text-align:left;">
    üïµÔ∏è Mode incognito
  </button>
</div>
<script>
// üïµÔ∏è Mode incognito
document.getElementById("btnIncognito").addEventListener("click", function () {
  localStorage.clear();
  sessionStorage.clear();
  alert("üïµÔ∏è Mode incognito activ√© : donn√©es locales effac√©es temporairement.");
});
</script>
<input id="bgColorPicker" style="display:none;" type="color"/></div>
<webview id="searchResults"></webview>
<footer id="footer">¬© 2025 Moteur de Recherche. Tous droits r√©serv√©s.</footer>
<script>
    // Raccourcis clavier globaux
    document.addEventListener('keydown', function(e) {
      // Pour √©viter d'interf√©rer avec la saisie dans un champ texte
      const activeTag = document.activeElement.tagName.toLowerCase();
      if (activeTag === 'input' || activeTag === 'textarea' || document.activeElement.isContentEditable) {
        return;
      }

      // Ctrl+Y : Ouvre YouTube
      if (e.ctrlKey && e.key.toLowerCase() === 'y') {
        window.open('https://www.youtube.com', '_blank', 'noopener');
        e.preventDefault();
      }

      // Ctrl+G : Ouvre Gmail
      if (e.ctrlKey && e.key.toLowerCase() === 'g') {
        window.open('https://mail.google.com', '_blank', 'noopener');
        e.preventDefault();
      }

      // Ctrl+M : Ouvre le menu hamburger
      if (e.ctrlKey && e.key.toLowerCase() === 'm') {
        const sideMenu = document.getElementById('sideMenu');
        if (sideMenu) sideMenu.classList.add('open');
        e.preventDefault();
      }

      // Ctrl+F : Plein √©cran
      if (e.ctrlKey && e.key.toLowerCase() === 'f') {
        toggleFullscreen();
        e.preventDefault();
      }

      // Ctrl+W : Fermer l'application
      if (e.ctrlKey && e.key.toLowerCase() === 'w') {
        closeApp();
        e.preventDefault();
      }
      
      // Ctrl+T : Nouvel onglet
      if (e.ctrlKey && e.key.toLowerCase() === 't') {
        addNewTab();
        e.preventDefault();
      }
      
      // √âchap : Fermer le menu lat√©ral
      if (e.key === 'Escape') {
        const sideMenu = document.getElementById('sideMenu');
        if (sideMenu && sideMenu.classList.contains('open')) {
          sideMenu.classList.remove('open');
          e.preventDefault();
        }
      }
    });

    function searchDuckDuckGo() {
      const query = document.getElementById('searchInput').value.trim();
      if (query) {
        const mainContent = document.getElementById('mainContent');
        const footer = document.getElementById('footer');
        const searchResults = document.getElementById('searchResults');
        const controlButtons = document.getElementById('controlButtons');

        // Hide the main content and footer
        mainContent.style.display = 'none';
        footer.style.display = 'none';

        // Show the webview and control buttons
        searchResults.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "block";
        controlButtons.style.display = 'flex';

        // Load DuckDuckGo results
        searchResults.src = `https://duckduckgo.com/?q=${encodeURIComponent(query)}`;
      } else {
        alert('Veuillez entrer un terme de recherche.');
      }
    }

    function goBack() {
      const mainContent = document.getElementById('mainContent');
      const footer = document.getElementById('footer');
      const searchResults = document.getElementById('searchResults');
      const controlButtons = document.getElementById('controlButtons');

      // Show the main content and footer
      mainContent.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "none";
      footer.style.display = 'block';

      // Hide the webview and control buttons
      searchResults.style.display = 'none';
      controlButtons.style.display = 'none';

      // Clear the webview content
      searchResults.src = '';
    }

    function refreshResults() {
      const searchResults = document.getElementById('searchResults');

      // Reload the current content of the webview
      if (searchResults.src) {
        searchResults.reload();
      }
    }

    function addNewTab() {
  const tabBar = document.getElementById('tabBar');
  const mainContent = document.getElementById('mainContent');
  const footer = document.getElementById('footer');
  const searchResults = document.getElementById('searchResults');
  const controlButtons = document.getElementById('controlButtons');

  const newTab = document.createElement('div');
  const tabCount = tabBar.getElementsByClassName('tab').length;

  newTab.className = 'tab';
  newTab.innerHTML = `
    Onglet ${tabCount + 1}
    <button class="fav-btn" title="Ajouter aux favoris" onclick="addCurrentToFavorites()" style="margin-left:6px; background:none; border:none; color:#ffc107; font-size:1rem; cursor:pointer;">‚≠ê</button>
    <button class="close-btn" onclick="closeTab(this)">&times;</button>
  `;
  newTab.setAttribute('onclick', "switchToTab(this, 'mainContent')");
  tabBar.insertBefore(newTab, tabBar.lastElementChild);

  mainContent.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "none";
  footer.style.display = 'block';
  searchResults.style.display = 'none';
  controlButtons.style.display = 'none';
  searchResults.src = '';

  setActiveTab(newTab);
}

    function closeTab(button) {
      const tab = button.parentElement;
      const tabBar = document.getElementById('tabBar');
      tabBar.removeChild(tab);

      if (tab.classList.contains('active') && tabBar.getElementsByClassName('tab').length > 0) {
        setActiveTab(tabBar.getElementsByClassName('tab')[0]);
      }
    }

    function switchToTab(tab, contentId) {
      const mainContent = document.getElementById('mainContent');
      const footer = document.getElementById('footer');
      const searchResults = document.getElementById('searchResults');
      const controlButtons = document.getElementById('controlButtons');

      // Switch between main content and webview depending on the tab content
      if (contentId === 'mainContent') {
        mainContent.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "none";
        footer.style.display = 'block';
        searchResults.style.display = 'none';
        controlButtons.style.display = 'none';
      } else {
        mainContent.style.display = 'none';
        footer.style.display = 'none';
        searchResults.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "block";
        controlButtons.style.display = 'flex';
      }

      setActiveTab(tab);
    }

    function setActiveTab(tab) {
      const tabs = document.getElementsByClassName('tab');
      for (let t of tabs) {
        t.classList.remove('active');
      }
      tab.classList.add('active');
    }
    
    // Hamburger menu functionality am√©lior√©e
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerBtn = document.getElementById('hamburgerBtn');
      const sideMenu = document.getElementById('sideMenu');
      const closeMenuBtn = document.getElementById('closeMenuBtn');

      hamburgerBtn.onclick = function(e) {
        e.stopPropagation();
        sideMenu.classList.add('open');
      };

      closeMenuBtn.onclick = function(e) {
        e.stopPropagation();
        sideMenu.classList.remove('open');
      };

      // Emp√™che la fermeture si on clique dans le menu
      sideMenu.onclick = function(e) {
        e.stopPropagation();
      };

      // Ferme le menu si on clique ailleurs
      window.addEventListener('click', function() {
        if (sideMenu.classList.contains('open')) {
          sideMenu.classList.remove('open');
        }
      });
    });
    
    // Contr√¥les d'application
    function closeApp() {
      // Fonctionne seulement si la fen√™tre a √©t√© ouverte par JS ou dans Electron
      if (window.electron) {
        window.electron.closeWindow();
      } else if (window.close) {
        window.close();
      } else {
        alert("Cette action n'est pas support√©e dans ce navigateur.");
      }
    }

    function toggleFullscreen() {
      if (window.electron) {
        window.electron.toggleFullscreen();
      } else if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch((err) => {
          alert(`Erreur lors du passage en plein √©cran : ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function minimizeWindow() {
      // Sur le web, il n'est pas possible de minimiser la fen√™tre via JS standard.
      // Si vous √™tes dans Electron, utilisez l'API Electron ici.
      if (window.electron) {
        window.electron.minimizeWindow();
      } else {
        alert("La r√©duction de la fen√™tre n'est pas support√©e dans ce navigateur.");
      }
    }
    
    // Fonction Accueil
    function goHome() {
      goBack();
      document.getElementById('sideMenu').classList.remove('open');
    }
  </script>
<script>
function searchFlox() {
  const query = document.getElementById("searchInput").value.trim();
  if (query) {
    const webview = document.getElementById("searchResults");
    const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
    webview.src = googleUrl;
    webview.style.display = "flex";
  }
}

window.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    const splash = document.getElementById('floxSplashScreen');
    if (splash) {
      splash.classList.add('hide');
      setTimeout(() => splash.remove(), 900);
    }
  }, 1200);
});
</script><script>
if (window.isDesktopApp) {
function toggleSettingsMenu() {
  const menu = document.getElementById("settingsSubMenu");
  if (menu) {
    menu.style.display = menu.style.display === "none" ? "block" : "none";
  
document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

}

document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

}

// Gestionnaire de mots de passe
document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  alert("Ouverture du gestionnaire de mots de passe (fonction √† impl√©menter)");
  document.getElementById("settingsSubMenu").style.display = "none";

document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

});

// Personnalisation de fond
document.getElementById("customBgMenuBtn").addEventListener("click", function () {
  const color = prompt("Entrez une couleur HEX pour le fond (ex: #1a1a1a):");
  if (color) {
    document.body.style.background = color;
    localStorage.setItem("customBackground", color);
  
document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

}
  document.getElementById("settingsSubMenu").style.display = "none";

document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

});

// Charger fond personnalis√© si pr√©sent
window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  
document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

}

document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

});

document.getElementById("openPwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.getElementById("closePwdManagerBtn").addEventListener("click", function () {
  const modal = document.getElementById("passwordManagerModal");
  if (modal) modal.style.display = "none";
});

document.getElementById("addPwdForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const site = document.getElementById("pwdSite").value.trim();
  const login = document.getElementById("pwdLogin").value.trim();
  const password = document.getElementById("pwdPassword").value.trim();
  if (site && login && password) {
    const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
    entries.push({ site, login, password });
    localStorage.setItem("passwords", JSON.stringify(entries));
    renderPasswordList();
    this.reset();
  }
});

function renderPasswordList() {
  const list = document.getElementById("pwdList");
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  list.innerHTML = "";
  if (entries.length === 0) {
    list.innerHTML = "<p style='text-align:center; color:#aaa;'>Aucun mot de passe enregistr√©.</p>";
    return;
  }
  entries.forEach((item, index) => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${item.site}</strong> ‚Äì ${item.login} <button onclick="deletePassword(${index})" style="margin-left:10px;color:#dc3545;background:none;border:none;cursor:pointer;">Supprimer</button>`;
    list.appendChild(div);
  });
}

function deletePassword(index) {
  const entries = JSON.parse(localStorage.getItem("passwords") || "[]");
  entries.splice(index, 1);
  localStorage.setItem("passwords", JSON.stringify(entries));
  renderPasswordList();
}

window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  if (savedColor) {
    document.body.style.background = savedColor;
  }
  renderPasswordList();
});

}</script>
<div id="passwordManagerModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:99999; align-items:center; justify-content:center;">
<div style="background:#222; color:#fff; border-radius:10px; min-width:320px; max-width:95vw; width:400px; padding:22px 18px 18px 18px; box-shadow:0 8px 32px #0008; position:relative;">
<button aria-label="Fermer" id="closePwdManagerBtn" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.7rem; cursor:pointer;">√ó</button>
<h2 style="margin-top:0; margin-bottom:18px; font-size:1.3rem; text-align:center;">üîë Gestionnaire de mots de passe</h2>
<form id="addPwdForm" style="display:flex; gap:7px; flex-wrap:wrap; margin-bottom:14px;">
<input "="" id=" placeholder=" required="" style="flex:1 1 90px; padding:5px; border-radius:4px; border:1px solid #007bff; font-size:1em;" type="text"/>
<input "="" id=" placeholder=" required="" style="flex:1 1 90px; padding:5px; border-radius:4px; border:1px solid #007bff; font-size:1em;" type="text"/>
<input "="" id=" placeholder=" required="" style="flex:1 1 90px; padding:5px; border-radius:4px; border:1px solid #007bff; font-size:1em;" type="password"/>
<button style="background:#007bff; color:#fff; border:none; border-radius:4px; padding:5px 12px; cursor:pointer;" type="submit">Ajouter</button>
</form>
<div id="pwdList" style="max-height:260px; overflow-y:auto; border-top:1px solid #444; padding-top:8px;"></div>
</div>
</div>
<div id="backgroundCustomizeModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:99998; align-items:center; justify-content:center;">
<div style="background:#222; color:#fff; border-radius:10px; min-width:300px; max-width:90vw; width:360px; padding:20px; box-shadow:0 8px 32px #0008; position:relative;">
<button aria-label="Fermer" id="closeBgCustomizeBtn" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.7rem; cursor:pointer;">√ó</button>
<h2 style="margin-top:0; margin-bottom:18px; font-size:1.3rem; text-align:center;">üé® Personnaliser le fond</h2>
<div style="display:flex; flex-direction:column; gap:10px;">
<label>Choisir une couleur :
        <input id="bgColorInput" style="margin-left:10px;" type="color"/>
</label>
<label>Choisir une image :
        <input accept="image/*" id="bgImageInput" style="margin-left:10px;" type="file"/>
</label>
<button id="resetBackgroundBtn" style="background:#dc3545; color:#fff; padding:8px; border:none; border-radius:5px; cursor:pointer;">R√©initialiser le fond</button>
</div>
</div>
</div>
<script>
document.getElementById("customBgMenuBtn").onclick = function () {
  const modal = document.getElementById("backgroundCustomizeModal");
  if (modal) modal.style.display = "flex";
  document.getElementById("settingsSubMenu").style.display = "none";
};

document.getElementById("closeBgCustomizeBtn").onclick = function () {
  document.getElementById("backgroundCustomizeModal").style.display = "none";
};

document.getElementById("bgColorInput").addEventListener("input", function () {
  const color = this.value;
  document.body.style.background = color;
  document.body.style.backgroundImage = "";
  localStorage.setItem("customBackground", color);
  localStorage.removeItem("customBackgroundImage");
});

document.getElementById("bgImageInput").addEventListener("change", function () {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const imageUrl = e.target.result;
      document.body.style.background = "";
      document.body.style.backgroundImage = `url('${imageUrl}')`;
      document.body.style.backgroundSize = "cover";
      localStorage.setItem("customBackgroundImage", imageUrl);
      localStorage.removeItem("customBackground");
    };
    reader.readAsDataURL(file);
  }
});

document.getElementById("resetBackgroundBtn").addEventListener("click", function () {
  localStorage.removeItem("customBackground");
  localStorage.removeItem("customBackgroundImage");
  document.body.style.background = "";
  document.body.style.backgroundImage = "";
});

// Charger les pr√©f√©rences au d√©marrage
window.addEventListener("DOMContentLoaded", () => {
  const savedColor = localStorage.getItem("customBackground");
  const savedImage = localStorage.getItem("customBackgroundImage");
  if (savedColor) {
    document.body.style.background = savedColor;
    document.body.style.backgroundImage = "";
  } else if (savedImage) {
    document.body.style.backgroundImage = `url('${savedImage}')`;
    document.body.style.backgroundSize = "cover";
  }
});
</script><script>
document.getElementById("searchBtn").addEventListener("click", function () {
  const query = document.getElementById("searchInput").value.trim();
  if (query) {
    const mainContent = document.getElementById("mainContent");
    const footer = document.getElementById("footer");
    const searchResults = document.getElementById("searchResults");
    const controlButtons = document.getElementById("controlButtons");

    // Hide main content and footer
    mainContent.style.display = 'none';
    footer.style.display = 'none';

    // Show WebView
    searchResults.style.display = 'flex';
        document.getElementById("addressBarContainer").style.display = "block";
    controlButtons.style.display = 'flex';

    // Load Google search
    loadInWebview(`https://www.google.com/search?q=${encodeURIComponent(query)}`);
  }
});
</script><script>
function addCurrentToFavorites() {
  const url = document.getElementById("searchResults")?.src;
  if (!url || url === "") {
    alert("Aucun contenu √† ajouter aux .");
    return;
  }

  const title = prompt("Nom du favori :", "Favori Google");
  if (!title) return;

  const favorites = JSON.parse(localStorage.getItem("floxFavorites") || "[]");
  favorites.push({ title, url });
  localStorage.setItem("floxFavorites", JSON.stringify(favorites));

  renderFavorites();
}

function renderFavorites() {
  const favList = document.getElementById("favoritesList");
  favList.innerHTML = "";

  const favorites = JSON.parse(localStorage.getItem("floxFavorites") || "[]");
  favorites.forEach((fav, index) => {
    const container = document.createElement("div");
    container.className = "favorite-item";
    container.title = fav.title;
    container.style.display = "flex";
    container.style.alignItems = "center";
    container.style.justifyContent = "space-between";
    container.style.gap = "10px";

    const favDiv = document.createElement("div");
    favDiv.textContent = fav.title;
    favDiv.style.cursor = "pointer";
    favDiv.onclick = function () {
      document.getElementById("searchResults").src = fav.url;
      document.getElementById("mainContent").style.display = "none";
      document.getElementById("footer").style.display = "none";
      document.getElementById("searchResults").style.display = "flex";
      document.getElementById("controlButtons").style.display = "flex";
    };

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "üóëÔ∏è";
    deleteBtn.style.border = "none";
    deleteBtn.style.background = "none";
    deleteBtn.style.cursor = "pointer";
    deleteBtn.title = "Supprimer ce favori";
    deleteBtn.onclick = function (e) {
      e.stopPropagation();
      favorites.splice(index, 1);
      localStorage.setItem("floxFavorites", JSON.stringify(favorites));
      renderFavorites();
    };

    container.appendChild(favDiv);
    container.appendChild(deleteBtn);
    favList.appendChild(container);
  });
}

window.addEventListener("DOMContentLoaded", function () {
  renderFavorites();
});
</script>
<div id="downloadsModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:99998; align-items:center; justify-content:center;">
<div style="background:#222; color:#fff; border-radius:10px; min-width:300px; max-width:90vw; width:360px; padding:20px; box-shadow:0 8px 32px #0008; position:relative;">
<button aria-label="Fermer" id="closeDownloadsBtn" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.7rem; cursor:pointer;">√ó</button>
<h2 style="margin-top:0; margin-bottom:18px; font-size:1.3rem; text-align:center;">‚¨áÔ∏è T√©l√©chargements</h2>
<p style="text-align:center; color:#aaa;">Aucun t√©l√©chargement en cours.</p>
</div>
</div>
<script>
const downloadsMenuBtn = document.getElementById("downloadsMenuBtn");
if (downloadsMenuBtn) {
  downloadsMenuBtn.onclick = function () {
    document.getElementById("downloadsModal").style.display = "flex";
    const settingsSubMenu = document.getElementById("settingsSubMenu");
    if (settingsSubMenu) settingsSubMenu.style.display = "none";
  };
}
const closeDownloadsBtn = document.getElementById("closeDownloadsBtn");
if (closeDownloadsBtn) {
  closeDownloadsBtn.onclick = function () {
    document.getElementById("downloadsModal").style.display = "none";
  };
}
</script>
<div id="languageModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:99998; align-items:center; justify-content:center;">
<div style="background:#222; color:#fff; border-radius:10px; width:320px; padding:20px; box-shadow:0 8px 32px #0008; position:relative;">
<button aria-label="Fermer" id="closeLanguageBtn" style="position:absolute; top:10px; right:14px; background:none; border:none; color:#fff; font-size:1.7rem; cursor:pointer;">√ó</button>
<h2 id="chooseLangTitle" style="text-align:center;">üåê Choisir la langue</h2>
<div style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
<button id="langBtnFr" onclick="setLanguage('fr')" style="padding:8px; font-size:1rem; border-radius:5px; border:none; cursor:pointer;">Fran√ßais üá´üá∑</button>
<button id="langBtnEn" onclick="setLanguage('en')" style="padding:8px; font-size:1rem; border-radius:5px; border:none; cursor:pointer;">English üá¨üáß</button>
<button id="langBtnEs" onclick="setLanguage('es')" style="padding:8px; font-size:1rem; border-radius:5px; border:none; cursor:pointer;">Espa√±ol üá™üá∏</button>
<button id="langBtnPt" onclick="setLanguage('pt')" style="padding:8px; font-size:1rem; border-radius:5px; border:none; cursor:pointer;">Portugu√™s üáßüá∑</button>
<button id="langBtnBr" onclick="setLanguage('br')" style="padding:8px; font-size:1rem; border-radius:5px; border:none; cursor:pointer;">Brezhoneg üáßüá∑</button>
</div>
</div>
</div>
<script>
const translations = {
  fr: {
    search: "Rechercher",
    home: "Accueil",
    clearHistory: "üóëÔ∏è Supprimer l'historique",
    darkMode: "üåô Mode sombre",
    favorites: "‚≠ê Favoris rapides :",
    history: "üìú Historique",
    chooseLang: "üåê Choisissez votre langue",
    lang: "üåê Langue",
    addFavorite: "‚ûï Ajouter un favori",
    back: "‚¨ÖÔ∏è",
    refresh: "üîÑ",
    footer: "¬© 2025 Moteur de Recherche. Tous droits r√©serv√©s.",
    customLinkPlaceholder: "Entrez ou collez un lien ici...",
    go: "Aller",
    pwdManager: "üîë Gestionnaire de mots de passe",
    downloads: "‚¨áÔ∏è T√©l√©chargements",
    customizeBg: "üé® Personnaliser le fond",
    keyboardSound: "‚å®Ô∏è Bruit de clavier personnalis√© :",
    musicBg: "üéµ Musique de fond :",
    gpuProfiles: "üß† Profils GPU",
    systemOpt: "üõ†Ô∏è Optimisation syst√®me",
    autoOptimize: "Optimiser automatiquement",
    manualOptimize: "Optimisation manuelle",
    chooseFile: "Choisir un fichier",
    noFile: "Aucun fichier choisi",
    disabled: "D√©sactiv√©",
    changeResolution: "Changer la r√©solution",
    chooseResolution: "üñ•Ô∏è Choisir la r√©solution",
    settings: "‚öôÔ∏è Param√®tres"
  },
  en: {
    search: "Search",
    home: "Home",
    clearHistory: "üóëÔ∏è Clear history",
    darkMode: "üåô Dark mode",
    favorites: "‚≠ê Quick favorites:",
    history: "üìú History",
    chooseLang: "üåê Choose your language",
    lang: "üåê Language",
    addFavorite: "‚ûï Add favorite",
    back: "‚¨ÖÔ∏è",
    refresh: "üîÑ",
    footer: "¬© 2025 Search Engine. All rights reserved.",
    customLinkPlaceholder: "Enter or paste a link here...",
    go: "Go",
    pwdManager: "üîë Password Manager",
    downloads: "‚¨áÔ∏è Downloads",
    customizeBg: "üé® Customize background",
    keyboardSound: "‚å®Ô∏è Custom keyboard sound:",
    musicBg: "üéµ Background music:",
    gpuProfiles: "üß† GPU Profiles",
    systemOpt: "üõ†Ô∏è System Optimization",
    autoOptimize: "Auto optimize",
    manualOptimize: "Manual optimization",
    chooseFile: "Choose file",
    noFile: "No file chosen",
    disabled: "Disabled",
    changeResolution: "Change resolution",
    chooseResolution: "üñ•Ô∏è Choose resolution",
    settings: "‚öôÔ∏è Settings"
  },
  es: {
    search: "Buscar",
    home: "Inicio",
    clearHistory: "üóëÔ∏è Borrar historial",
    darkMode: "üåô Modo oscuro",
    favorites: "‚≠ê Favoritos r√°pidos:",
    history: "üìú Historial",
    chooseLang: "üåê Elija su idioma",
    lang: "üåê Idioma",
    addFavorite: "‚ûï A√±adir favorito",
    back: "‚¨ÖÔ∏è",
    refresh: "üîÑ",
    footer: "¬© 2025 Motor de B√∫squeda. Todos los derechos reservados.",
    customLinkPlaceholder: "Ingrese o pegue un enlace aqu√≠...",
    go: "Ir",
    pwdManager: "üîë Gestor de contrase√±as",
    downloads: "‚¨áÔ∏è Descargas",
    customizeBg: "üé® Personalizar fondo",
    keyboardSound: "‚å®Ô∏è Sonido de teclado personalizado:",
    musicBg: "üéµ M√∫sica de fondo:",
    gpuProfiles: "üß† Perfiles de GPU",
    systemOpt: "üõ†Ô∏è Optimizaci√≥n del sistema",
    autoOptimize: "Optimizar autom√°ticamente",
    manualOptimize: "Optimizaci√≥n manual",
    chooseFile: "Elegir archivo",
    noFile: "Ning√∫n archivo elegido",
    disabled: "Desactivado",
    changeResolution: "Cambiar resoluci√≥n",
    chooseResolution: "üñ•Ô∏è Elegir resoluci√≥n",
    settings: "‚öôÔ∏è Configuraci√≥n"
  },
  pt: {
    search: "Pesquisar",
    home: "In√≠cio",
    clearHistory: "üóëÔ∏è Limpar hist√≥rico",
    darkMode: "üåô Modo escuro",
    favorites: "‚≠ê Favoritos r√°pidos:",
    history: "üìú Hist√≥rico",
    chooseLang: "üåê Escolha o idioma",
    lang: "üåê Idioma",
    addFavorite: "‚ûï Adicionar favorito",
    back: "‚¨ÖÔ∏è",
    refresh: "üîÑ",
    footer: "¬© 2025 Motor de Busca. Todos os direitos reservados.",
    customLinkPlaceholder: "Digite ou cole um link aqui...",
    go: "Ir",
    pwdManager: "üîë Gerenciador de senhas",
    downloads: "‚¨áÔ∏è Downloads",
    customizeBg: "üé® Personalizar fundo",
    keyboardSound: "‚å®Ô∏è Som de teclado personalizado:",
    musicBg: "üéµ M√∫sica de fundo:",
    gpuProfiles: "üß† Perfis de GPU",
    systemOpt: "üõ†Ô∏è Otimiza√ß√£o do sistema",
    autoOptimize: "Otimizar automaticamente",
    manualOptimize: "Otimiza√ß√£o manual",
    chooseFile: "Escolher arquivo",
    noFile: "Nenhum arquivo escolhido",
    disabled: "Desativado",
    changeResolution: "Alterar resolu√ß√£o",
    chooseResolution: "üñ•Ô∏è Escolher resolu√ß√£o",
    settings: "‚öôÔ∏è Configura√ß√µes"
  },
  br: {
    search: "Klask",
    home: "Degemer",
    clearHistory: "üóëÔ∏è Dilemel an istor",
    darkMode: "üåô Mod te√±val",
    favorites: "‚≠ê Favoris buan:",
    history: "üìú Istor",
    chooseLang: "üåê Dibabit ho yezh",
    lang: "üåê Yezh",
    addFavorite: "‚ûï Ouzhpenna√± ur sined",
    back: "‚¨ÖÔ∏è",
    refresh: "üîÑ",
    footer: "¬© 2025 Klasker. Gwirio√π aotreet.",
    customLinkPlaceholder: "Lakait pe pegit ul liamm ama√±...",
    go: "Mont",
    pwdManager: "üîë Merour ger-tremen",
    downloads: "‚¨áÔ∏è Pellgargadurio√π",
    customizeBg: "üé® Personnaliza√± an drekleur",
    keyboardSound: "‚å®Ô∏è Son ar stlenneg personelaet:",
    musicBg: "üéµ Son drekleur:",
    gpuProfiles: "üß† Profilo√π GPU",
    systemOpt: "üõ†Ô∏è Gwella√± ar reizhiad",
    autoOptimize: "Gwella√± emgefreek",
    manualOptimize: "Gwella√± dre zorn",
    chooseFile: "Dibab ur restr",
    noFile: "Restr ebet dibabet",
    disabled: "Diweredekaet",
    changeResolution: "Kemma√± ar silvidigezh",
    chooseResolution: "üñ•Ô∏è Dibab ar silvidigezh",
    settings: "‚öôÔ∏è Arventenno√π"
  }
};

function applyTranslations() {
  const lang = localStorage.getItem("floxLang") || "fr";
  const t = translations[lang];

  if (!t) return;

  // Boutons principaux
  if (document.getElementById("searchBtn")) document.getElementById("searchBtn").textContent = t.search;
  if (document.getElementById("clearHistoryBtn")) document.getElementById("clearHistoryBtn").textContent = t.clearHistory;
  if (document.getElementById("toggleDarkModeBtn")) document.getElementById("toggleDarkModeBtn").textContent = t.darkMode;
  if (document.getElementById("openHistoryBtn")) document.getElementById("openHistoryBtn").textContent = t.history;

  // Barre favoris rapide
  const favText = document.querySelector("#favoritesShortcutBar span");
  if (favText) favText.innerHTML = `<i class="fas fa-star"></i> ${t.favorites}`;

  // Titre modal langue
  if (document.getElementById("chooseLangTitle")) document.getElementById("chooseLangTitle").textContent = t.chooseLang;

  // Boutons de langue
  if (document.getElementById("langBtnFr")) document.getElementById("langBtnFr").textContent = "Fran√ßais üá´üá∑";
  if (document.getElementById("langBtnEn")) document.getElementById("langBtnEn").textContent = "English üá¨üáß";
  if (document.getElementById("langBtnEs")) document.getElementById("langBtnEs").textContent = "Espa√±ol üá™üá∏";
  if (document.getElementById("langBtnPt")) document.getElementById("langBtnPt").textContent = "Portugu√™s üáßüá∑";
  if (document.getElementById("langBtnBr")) document.getElementById("langBtnBr").textContent = "Brezhoneg üáßüá∑";

  // Placeholder barre de recherche
  if (document.getElementById("searchInput")) document.getElementById("searchInput").placeholder = t.search;

  // Accueil onglet
  const defaultTab = document.getElementById("defaultTab");
  if (defaultTab && defaultTab.childNodes[0]) defaultTab.childNodes[0].nodeValue = t.home + " ";

  // Bouton ajouter favori
  const addFavBtn = document.querySelector("#favoritesShortcutBar button[onclick^='manualAddFavorite']");
  if (addFavBtn) addFavBtn.textContent = t.addFavorite;

  // Boutons retour/refresh
  const backBtn = document.querySelector(".favorites-bar button[onclick^='goBack']");
  if (backBtn) backBtn.textContent = t.back;
  const refreshBtn = document.querySelector(".favorites-bar button[onclick^='refreshResults']");
  if (refreshBtn) refreshBtn.textContent = t.refresh;

  // Footer
  if (document.getElementById("footer")) document.getElementById("footer").textContent = t.footer;

  // Barre de lien personnalis√©e
  const customLinkInput = document.getElementById("customLinkInput");
  if (customLinkInput) customLinkInput.placeholder = t.customLinkPlaceholder;
  const customLinkGoBtn = document.getElementById("customLinkGoBtn");
  if (customLinkGoBtn) customLinkGoBtn.textContent = t.go;

  // Gestionnaire de mots de passe
  const pwdBtn = document.getElementById("openPwdManagerBtn");
  if (pwdBtn) pwdBtn.textContent = t.pwdManager;
  const pwdBtn2 = document.getElementById("passwordManagerModal")?.querySelector("h2");
  if (pwdBtn2) pwdBtn2.textContent = t.pwdManager;

  // T√©l√©chargements
  const downloadsBtn = document.getElementById("downloadsMenuBtn");
  if (downloadsBtn) downloadsBtn.textContent = t.downloads;
  const downloadsModalTitle = document.getElementById("downloadsModal")?.querySelector("h2");
  if (downloadsModalTitle) downloadsModalTitle.textContent = t.downloads;

  // Personnaliser le fond
  const customBgBtn = document.getElementById("customBgMenuBtn");
  if (customBgBtn) customBgBtn.textContent = t.customizeBg;
  const bgModalTitle = document.getElementById("backgroundCustomizeModal")?.querySelector("h2");
  if (bgModalTitle) bgModalTitle.textContent = t.customizeBg;

  // ‚å®Ô∏è Bruit de clavier personnalis√©
  const keyboardLabel = document.querySelector("label[for='customKeyboardSound']") ||
    Array.from(document.querySelectorAll("label")).find(l => l.textContent?.includes("‚å®Ô∏è"));
  if (keyboardLabel) keyboardLabel.childNodes[0].nodeValue = t.keyboardSound + " ";

  // üéµ Musique de fond
  const musicLabel = document.querySelector("label[for='backgroundMusicFile']") ||
    Array.from(document.querySelectorAll("label")).find(l => l.textContent?.includes("üéµ"));
  if (musicLabel) musicLabel.childNodes[0].nodeValue = t.musicBg + " ";

  // üß† Profils GPU
  const gpuTitle = document.querySelector(".optimizer-section h3");
  if (gpuTitle) gpuTitle.textContent = t.gpuProfiles;

  // üõ†Ô∏è Optimisation syst√®me
  const optSection = document.querySelector(".optimizer-section h2");
  if (optSection) optSection.textContent = t.systemOpt;

  // Optimiser automatiquement
  const autoBtn = document.getElementById("auto-optimize");
  if (autoBtn) autoBtn.textContent = t.autoOptimize;

  // Optimisation manuelle
  const manualBtn = document.getElementById("manual-optimize-toggle");
  if (manualBtn) manualBtn.textContent = t.manualOptimize;

  // Fichiers input : "Choisir un fichier" et "Aucun fichier choisi"
  // Pour tous les input[type=file]
  document.querySelectorAll('input[type="file"]').forEach(input => {
    // Change le label "Choisir un fichier"
    let label = input.parentElement;
    if (label && label.tagName === "LABEL") {
      // On cherche le texte avant l'input
      let nodes = Array.from(label.childNodes);
      for (let n of nodes) {
        if (n.nodeType === 3 && n.textContent.match(/Choisir une image|Choisir une couleur|Choisir un fichier|Choose file|Aucun fichier choisi|No file chosen|Nenhum arquivo escolhido|Ning√∫n archivo elegido|Dibab ur restr/)) {
          n.textContent = t.chooseFile + " : ";
        }
      }
    }
    // Change le texte "Aucun fichier choisi" dans le champ
    input.addEventListener("change", function () {
      let fileName = input.files.length ? input.files[0].name : t.noFile;
      input.title = fileName;
    });
    // Pour le texte par d√©faut (si pas de fichier)
    input.title = t.noFile;
  });

  // Boutons d√©sactiv√©s
  document.querySelectorAll('button:disabled').forEach(btn => {
    btn.textContent = t.disabled;
  });

  // Bouton "Changer la r√©solution"
  const resBtn = Array.from(document.querySelectorAll("button")).find(b => b.textContent?.includes("Changer la r√©solution") || b.textContent?.includes("Change resolution") || b.textContent?.includes("Alterar resolu√ß√£o") || b.textContent?.includes("Cambiar resoluci√≥n") || b.textContent?.includes("Kemma√± ar silvidigezh"));
  if (resBtn) resBtn.textContent = "üñ•Ô∏è " + t.changeResolution;

  // Titre modal r√©solution
  const resTitle = document.querySelector("#resolutionModal h2");
  if (resTitle) resTitle.textContent = t.chooseResolution;

  // üåê Langue bouton dans param√®tres
  const langBtn = document.getElementById("languageMenuBtn");
  if (langBtn) langBtn.innerHTML = t.lang;

  // ‚öôÔ∏è Param√®tres bouton principal (sidebar/hamburger)
  const settingsMenuBtn = document.getElementById("settingsMenuBtn");
  if (settingsMenuBtn) settingsMenuBtn.textContent = t.settings;

  // ‚öôÔ∏è Param√®tres titre modal
  const settingsModalTitle = document.querySelector("#settingsModal h2");
  if (settingsModalTitle) settingsModalTitle.textContent = t.settings;
}

function setLanguage(lang) {
  localStorage.setItem("floxLang", lang);
  applyTranslations();
  document.getElementById('languageModal').style.display = 'none';
}

window.addEventListener("DOMContentLoaded", () => {
  applyTranslations();
});

let ctrlAlt3Pressed = false;

document.addEventListener("keydown", function (e) {
  if (e.ctrlKey && e.altKey && e.key === "3") {
    ctrlAlt3Pressed = true;
    setTimeout(() => { ctrlAlt3Pressed = false; }, 3000);
    e.preventDefault();
  }

  if (ctrlAlt3Pressed && e.key === "5") {
    ctrlAlt3Pressed = false;
    localStorage.setItem("floxLang", "br");
    applyTranslations();
    alert("Langue breton activ√©e !");
    e.preventDefault();
  }
});

// Fermer la modale langue
document.getElementById("closeLanguageBtn").onclick = function () {
  document.getElementById("languageModal").style.display = "none";
};
</script>
<script>
function loadAddressBarURL() {
  const url = document.getElementById("addressBar").value.trim();
  const searchResults = document.getElementById("searchResults");
  const controlButtons = document.getElementById("controlButtons");

  if (!url) return;

  let finalUrl = url;
  if (!url.startsWith("http://") && !url.startsWith("https://")) {
    finalUrl = "https://www.google.com/search?q=" + encodeURIComponent(url);
  }

  searchResults.src = finalUrl;
  searchResults.style.display = "flex";
  controlButtons.style.display = "flex";
}
</script>
<script>
window.addEventListener("load", function () {
  const loader = document.getElementById("globalLoader");
  if (loader) {
    loader.style.opacity = "0";
    setTimeout(() => loader.remove(), 500);
  }
});
</script>
<script>
let progress = 0;
const progressBar = document.getElementById("loaderProgress");

function simulateLoading() {
  const interval = setInterval(() => {
    progress += Math.random() * 8;
    if (progress >= 100) {
      progress = 100;
      clearInterval(interval);
      const loader = document.getElementById("globalLoader");
      if (loader) {
        loader.style.opacity = "0";
        setTimeout(() => loader.remove(), 600);
      }
    }
    if (progressBar) progressBar.style.width = progress + "%";
  }, 150);
}

window.addEventListener("load", simulateLoading);
</script>
<script>
let keyboardSoundEnabled = true;
let customSoundURL = null;
const audioElement = document.getElementById("keyboardSound");
const fileInput = document.getElementById("customKeyboardSound");

document.getElementById("keyboardSoundToggleBtn").addEventListener("click", function () {
  keyboardSoundEnabled = !keyboardSoundEnabled;
  this.textContent = keyboardSoundEnabled ? "D√©sactiver" : "Activer";
  document.getElementById("settingsSubMenu").style.display = "none";
});

fileInput.addEventListener("change", function () {
  const file = this.files[0];
  if (file) {
    customSoundURL = URL.createObjectURL(file);
  }
  document.getElementById("settingsSubMenu").style.display = "none";
});

document.addEventListener("keydown", function (e) {
  const tag = e.target.tagName.toLowerCase();
  if (keyboardSoundEnabled && (tag === "input" || tag === "textarea")) {
    let player = audioElement;
    if (customSoundURL) {
      player = new Audio(customSoundURL);
    }
    player.currentTime = 0;
    player.play().catch(() => {});
  }
});
</script>
<script>
const musicPlayer = document.getElementById("backgroundMusic");
const musicInput = document.getElementById("backgroundMusicFile");
const toggleBtn = document.getElementById("toggleMusicBtn");

let musicLoaded = false;

musicInput.addEventListener("change", function () {
  const file = this.files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    musicPlayer.src = url;
    musicPlayer.volume = 0.3;
    musicPlayer.play().catch(() => {});
    musicLoaded = true;
  }
});

toggleBtn.addEventListener("click", function () {
  if (!musicLoaded) return;
  if (musicPlayer.paused) {
    musicPlayer.play();
  } else {
    musicPlayer.pause();
  }
  document.getElementById("settingsSubMenu").style.display = "none";
});
</script>
<script>
document.getElementById("optimizeSoundBtn").addEventListener("click", function () {
  // Simule l'optimisation RAM/GPU et le nettoyage
  alert("Optimisation appliqu√©e :\n- RAM et GPU r√©gl√©s √† la puissance parfaite\n- T√©l√©chargements et fichiers cach√©s vid√©s\n- Volume audio ajust√© !");
  if (musicPlayer) {
    musicPlayer.volume = 0.6;
  }
  // Vide la liste des t√©l√©chargements (affichage)
  const downloadsModal = document.getElementById("downloadsModal");
  if (downloadsModal) {
    const p = downloadsModal.querySelector("p");
    if (p) p.textContent = "Aucun t√©l√©chargement en cours.";
  }
  // Ajoute un effet visuel temporaire
  const optimizeDiv = document.createElement("div");
  optimizeDiv.textContent = "üí° RAM & GPU optimis√©s, fichiers temporaires nettoy√©s !";
  optimizeDiv.style.cssText = "position:fixed;top:30%;left:50%;transform:translate(-50%,-50%);background:#007bff;color:#fff;padding:18px 32px;border-radius:10px;font-size:1.3rem;z-index:999999;box-shadow:0 4px 32px #0008;";
  document.body.appendChild(optimizeDiv);
  setTimeout(() => optimizeDiv.remove(), 1800);

  document.getElementById("settingsSubMenu").style.display = "none";
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const volumeSlider = document.getElementById("volumeSlider");
  const backgroundMusic = document.getElementById("backgroundMusic");
  const bgInput = document.getElementById("backgroundImageInput");
  const themeSelect = document.getElementById("themeSelect");

  if (volumeSlider && backgroundMusic) {
    volumeSlider.addEventListener("input", function () {
      backgroundMusic.volume = parseFloat(this.value);
    });
  }

  if (bgInput) {
    bgInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        document.body.style.background = `url(${url}) no-repeat center center fixed`;
        document.body.style.backgroundSize = "cover";
      }
    });
  }

  if (themeSelect) {
    themeSelect.addEventListener("change", function () {
      const theme = this.value;
      if (theme === "light") {
        document.body.style.background = "#f1f1f1";
        document.body.style.color = "#000";
      } else if (theme === "neon") {
        document.body.style.background = "#000";
        document.body.style.color = "#0ff";
      } else {
        document.body.style.background = "#121212";
        document.body.style.color = "#fff";
      }
    });
  }
});
</script>
<script>
document.addEventListener("keydown", function (e) {
  if (e.ctrlKey && e.key === "1") {
    e.preventDefault();
    window.print();
  }
});
</script>
<script>
document.addEventListener("keydown", function (e) {
  if (e.ctrlKey && e.key.toLowerCase() === "1") {
    e.preventDefault();
    window.print();
  }
  if (e.ctrlKey && e.key.toLowerCase() === "g") {
    e.preventDefault();
    window.open("https://mail.google.com", "_blank");
  }
  if (e.ctrlKey && e.key.toLowerCase() === "y") {
    e.preventDefault();
    window.open("https://www.youtube.com", "_blank");
  }
});
</script>
<script>
let searchHistory = JSON.parse(localStorage.getItem("searchHistory") || "[]");

// Enregistrer les recherches
document.addEventListener("submit", function (e) {
  const target = e.target;
  if (target && target.tagName === "FORM") {
    const input = target.querySelector("input[type='text'], input[type='search']");
    if (input && input.value.trim() !== "") {
      searchHistory.unshift(input.value.trim());
      searchHistory = [...new Set(searchHistory)].slice(0, 50);
      localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
    }
  }
});

// Afficher l'historique dans la modale
document.getElementById("viewHistoryBtn").addEventListener("click", function () {
  const modal = document.getElementById("historyModal");
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  if (searchHistory.length === 0) {
    list.innerHTML = "<li>Aucune recherche enregistr√©e.</li>";
  } else {
    searchHistory.forEach(term => {
      const item = document.createElement("li");
      const link = document.createElement("a");
      link.href = "https://www.google.com/search?q=" + encodeURIComponent(term);
      link.target = "_blank";
      link.textContent = term;
      link.style.color = "#00aaff";
      item.appendChild(link);
      list.appendChild(item);
    });
  }
  modal.style.display = "flex";
});
</script>
<script>
function toggleSearchOptions() {
  const popup = document.getElementById("searchPopup");
  popup.style.display = popup.style.display === "none" ? "block" : "none";
}

function searchPlatform(platform) {
  const query = document.getElementById("searchQuery").value.trim();
  if (!query) return;
  let url = "";
  switch(platform) {
    case "youtube":
      url = "https://www.youtube.com/results?search_query=" + encodeURIComponent(query);
      break;
    case "twitch":
      url = "https://www.twitch.tv/search?term=" + encodeURIComponent(query);
      break;
    case "tiktok":
      url = "https://www.tiktok.com/search?q=" + encodeURIComponent(query);
      break;
  }
  window.open(url, "_blank");
}
</script>
<script>
function searchPlatform(platform) {
  const query = document.getElementById("popupSearchInput").value.trim();
  let url = "";

  if (platform === "youtube") {
    url = query
      ? "https://www.youtube.com/results?search_query=" + encodeURIComponent(query)
      : "https://www.youtube.com/";
  } else if (platform === "twitch") {
    url = query
      ? "https://www.twitch.tv/search?term=" + encodeURIComponent(query)
      : "https://www.twitch.tv/";
  } else if (platform === "tiktok") {
    url = query
      ? "https://www.tiktok.com/search?q=" + encodeURIComponent(query)
      : "https://www.tiktok.com/";
  }

  document.getElementById("mainContent").style.display = "none";
  document.getElementById("footer").style.display = "none";
  document.getElementById("searchResults").style.display = "flex";
  document.getElementById("addressBarContainer").style.display = "block";
  document.getElementById("controlButtons").style.display = "flex";

  document.getElementById("searchResults").src = url;

  document.getElementById("searchPopup").style.display = "none";
}
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const settingsBtn = document.getElementById("settingsMenuBtn");
  const settingsModal = document.getElementById("settingsModal");
  if (settingsBtn && settingsModal) {
    settingsBtn.addEventListener("click", () => {
      settingsModal.style.display = "flex";
    });
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const closeModal = document.querySelector("#settingsModal button[onclick*='style.display']");
  if (closeModal) {
    closeModal.addEventListener("click", () => {
      document.getElementById("settingsModal").style.display = "none";
    });
  }
});
</script>
<script>
function openPlatform(name) {
  const webview = document.getElementById("searchResults");
  let url = "";
  if (name === "youtube") url = "https://www.youtube.com/";
  if (name === "twitch") url = "https://www.twitch.tv/";
  if (name === "tiktok") url = "https://www.tiktok.com/";

  document.getElementById("mainContent").style.display = "none";
  document.getElementById("footer").style.display = "none";
  document.getElementById("searchResults").style.display = "flex";
  document.getElementById("addressBarContainer").style.display = "block";
  document.getElementById("controlButtons").style.display = "flex";
  webview.src = url;
}
</script>
<script>
document.getElementById("clearHistoryBtn").addEventListener("click", function () {
  const container = document.getElementById("searchHistoryContainer");
  if (container) container.innerHTML = '';
  localStorage.removeItem("floxSearchHistory");
  alert("Historique supprim√© !");
});
</script><script>
document.addEventListener("DOMContentLoaded", function () {
  const btn = document.getElementById("openHistoryBtn");
  if (btn) {
    btn.addEventListener("click", () => {
      const container = document.getElementById("historyModal");
      if (container) container.style.display = "flex";
    });
  }
});
</script><script>
document.addEventListener("DOMContentLoaded", function () {
  const input = document.getElementById("popupSearchInput") || document.getElementById("searchInput");
  const suggestionBox = document.getElementById("searchSuggestions");

  const history = JSON.parse(localStorage.getItem("floxSearchHistory") || "[]");

  if (input && suggestionBox) {
    input.addEventListener("input", function () {
      const q = input.value.toLowerCase();
      suggestionBox.innerHTML = "";
      if (!q || history.length === 0) {
        suggestionBox.style.display = "none";
        return;
      }

      const filtered = history.filter(item => item.toLowerCase().includes(q)).slice(0, 5);
      if (filtered.length > 0) {
        filtered.forEach(s => {
          const div = document.createElement("div");
          div.textContent = s;
          div.style.cssText = "padding:6px; cursor:pointer;";
          div.onclick = () => {
            input.value = s;
            suggestionBox.style.display = "none";
          };
          suggestionBox.appendChild(div);
        });
        suggestionBox.style.display = "block";
      } else {
        suggestionBox.style.display = "none";
      }
    });
  }

  // Th√®me dynamique bas√© sur l'heure
  const hour = new Date().getHours();
  if (hour >= 19 || hour < 6) {
    document.body.style.background = "#121212";
    document.body.style.color = "#fff";
  } else {
    document.body.style.background = "#fff";
    document.body.style.color = "#000";
  }
});
</script><script>
document.addEventListener("DOMContentLoaded", function () {
  const input = document.getElementById("popupSearchInput") || document.getElementById("searchInput");
  const engine = document.getElementById("searchEngineSelector");
  const webview = document.getElementById("searchResults");

  function getSearchURL(query, engineName) {
    const encoded = encodeURIComponent(query);
    if (query.includes("site:youtube.com")) return "https://www.youtube.com/results?search_query=" + encoded.replace("site%3Ayoutube.com+", "");
    if (query.includes("filetype:pdf")) return "https://www.google.com/search?q=" + encoded;
    switch (engineName) {
      case "duckduckgo": return "https://duckduckgo.com/?q=" + encoded;
      case "bing": return "https://www.bing.com/search?q=" + encoded;
      case "brave": return "https://search.brave.com/search?q=" + encoded;
      default: return "https://www.google.com/search?q=" + encoded;
    }
  }

  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      const query = input.value.trim();
      const engineName = engine.value;
      const url = getSearchURL(query, engineName);
      document.getElementById("mainContent").style.display = "none";
      document.getElementById("footer").style.display = "none";
      document.getElementById("searchResults").style.display = "flex";
      document.getElementById("addressBarContainer").style.display = "block";
      document.getElementById("controlButtons").style.display = "flex";
      webview.src = url;
    }
  }
)});
</script><script>
function toggleDarkMode() {
  const isDark = document.body.classList.toggle("dark-mode");
  localStorage.setItem("darkMode", isDark ? "enabled" : "disabled");
}

document.addEventListener("DOMContentLoaded", () => {
  if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark-mode");
  }
});
</script>
<script>
function addCurrentToFavorites() {
  const iframe = document.getElementById("searchResults");
  const url = iframe?.src || '';
  if (!url || url === "") {
    alert("Aucun contenu √† ajouter aux favoris.");
    return;
  }

  const title = prompt("Nom du favori :", "Nouvel onglet favori");
  if (!title) return;

  const favorites = JSON.parse(localStorage.getItem("floxFavorites") || "[]");
  favorites.push({ title, url });
  localStorage.setItem("floxFavorites", JSON.stringify(favorites));
  renderFavorites();
}

function clearAllFavorites() {
  if (confirm("√ätes-vous s√ªr de vouloir supprimer tous les favoris ?")) {
    localStorage.removeItem("floxFavorites");
    renderFavorites();
  }
}

function renderFavorites() {
  const list = document.getElementById("favoritesShortcutList");
  list.innerHTML = "";

  const favorites = JSON.parse(localStorage.getItem("floxFavorites") || "[]");

  favorites.forEach((fav, index) => {
    const container = document.createElement("div");
    container.style.display = "flex";
    container.style.alignItems = "center";
    container.style.gap = "6px";

    const btn = document.createElement("button");
    btn.className = "favorite-btn";
    btn.textContent = fav.title;
    btn.title = fav.url;
    btn.onclick = () => {
      const iframe = document.getElementById("searchResults");
      document.getElementById("mainContent").style.display = "none";
      document.getElementById("footer").style.display = "none";
      document.getElementById("searchResults").style.display = "flex";
      document.getElementById("addressBarContainer").style.display = "block";
      document.getElementById("controlButtons").style.display = "flex";
      iframe.src = fav.url;
    };

    const del = document.createElement("button");
    del.textContent = "üóëÔ∏è";
    del.title = "Supprimer ce favori";
    del.style.border = "none";
    del.style.background = "none";
    del.style.color = "#dc3545";
    del.style.fontSize = "1rem";
    del.style.cursor = "pointer";
    del.onclick = (e) => {
      e.stopPropagation();
      favorites.splice(index, 1);
      localStorage.setItem("floxFavorites", JSON.stringify(favorites));
      renderFavorites();
    };

    container.appendChild(btn);
    container.appendChild(del);
    list.appendChild(container);
  });
}

window.addEventListener("DOMContentLoaded", renderFavorites);
</script>
<script>
function applyResolutionToWebview() {
  const select = document.getElementById("resolutionSelect");
  const [width, height] = select.value.split("x");
  const webview = document.getElementById("searchResults");
  if (webview) {
    webview.style.width = width + "px";
    webview.style.height = height + "px";
  }
}

// √âtendre la fonction existante
const originalApplyResolution = window.applyResolution;
window.applyResolution = function() {
  originalApplyResolution();
  applyResolutionToWebview();
};
</script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  const webview = document.getElementById('searchResults');
  let zoomFactor = 1;

  function updateZoom() {
    if (webview && webview.setZoomFactor) {
      webview.setZoomFactor(zoomFactor);
    } else {
      webview.style.transform = `scale(${zoomFactor})`;
      webview.style.transformOrigin = '0 0';
    }
  }

  window.addEventListener('wheel', function (e) {
    if (e.ctrlKey) {
      e.preventDefault();
      if (e.deltaY < 0) {
        zoomFactor = Math.min(zoomFactor + 0.1, 3);
      } else {
        zoomFactor = Math.max(zoomFactor - 0.1, 0.3);
      }
      updateZoom();
    }
  }, { passive: false });
});
</script>
</body>
</html>